import fs from 'node:fs';
import path from 'node:path';

// import { toHash } from '@/utils/hash.js';
import { transformFile } from '@/utils/transform.js';

export const toPackageJson = () => {
  const content = `{
  "name": "dot-mdxlayer",
  "description": "This package is auto-generated by mdxlayer",
  "version": "0.0.0",
  "exports": {
    "./generated": {
      "import": "./generated/index.mjs",
      "require": "./generated/index.cjs"
    }
  },
  "typesVersions": {
    "*": {
      "generated": [
        "./generated"
      ]
    }
  }
}`;

  const pkgPath = path.resolve(process.cwd(), '.mdxlayer', 'package.json');

  const isChanged = !fs.existsSync(pkgPath);
  // ||
  // toHash(content) !== toHash(fs.readFileSync(pkgPath, 'utf-8'));

  if (isChanged) {
    // Adding package.json
    transformFile({
      doc: content,
      filename: 'package.json',
      subpath: '/',
    });
  }
};
